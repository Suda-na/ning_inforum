<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小宁论坛 - 综合运营指挥中心</title>
    
    <link href="css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css?v=4.1.0" rel="stylesheet">

    <style>
        /* ================= V4.0 旗舰版样式系统 ================= */
        :root {
            --primary: #4f46e5;       /* 核心蓝 */
            --primary-soft: #e0e7ff;
            --success: #10b981;       /* 成功绿 */
            --success-soft: #d1fae5;
            --warning: #f59e0b;       /* 警告黄 */
            --warning-soft: #fef3c7;
            --danger: #ef4444;        /* 危险红 */
            --danger-soft: #fee2e2;
            --dark: #111827;
            --gray: #6b7280;
            --bg: #f3f4f6;
            --card-radius: 16px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        body.gray-bg { background-color: var(--bg); font-family: 'Inter', "Helvetica Neue", Helvetica, Arial, sans-serif; color: #374151; }
        
        /* 1. 顶部状态栏 */
        .dashboard-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px; padding: 5px 10px;
        }
        .header-title h2 { margin: 0; font-weight: 800; color: var(--dark); font-size: 26px; letter-spacing: -0.5px; }
        .header-title small { color: var(--gray); font-size: 13px; font-weight: 500; }
        
        /* 2. 核心指标卡片 (融合了三个页面的关键数字) */
        .metric-card {
            background: #fff; border-radius: var(--card-radius); padding: 24px;
            position: relative; overflow: hidden; box-shadow: var(--shadow-sm);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid rgba(255,255,255,0.5);
            margin-bottom: 24px;
        }
        .metric-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-hover); }
        
        .metric-icon {
            width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center;
            font-size: 20px; margin-bottom: 15px;
        }
        .metric-value { font-size: 32px; font-weight: 800; color: var(--dark); line-height: 1.1; margin-bottom: 5px; }
        .metric-label { font-size: 14px; color: var(--gray); font-weight: 500; }
        .metric-trend {
            position: absolute; top: 24px; right: 24px; font-size: 13px; font-weight: 600;
            padding: 4px 10px; border-radius: 20px; display: flex; align-items: center; gap: 4px;
        }
        
        /* 颜色变体 */
        .card-blue .metric-icon { background: var(--primary-soft); color: var(--primary); }
        .card-blue .metric-trend { background: var(--primary-soft); color: var(--primary); }
        
        .card-green .metric-icon { background: var(--success-soft); color: var(--success); }
        .card-green .metric-trend { background: var(--success-soft); color: var(--success); }
        
        .card-orange .metric-icon { background: var(--warning-soft); color: var(--warning); }
        .card-orange .metric-trend { background: var(--warning-soft); color: var(--warning); }
        
        .card-red .metric-icon { background: var(--danger-soft); color: var(--danger); }
        .card-red .metric-trend { background: var(--danger-soft); color: var(--danger); }

        /* 3. 图表容器 */
        .chart-box {
            background: #fff; border-radius: var(--card-radius); padding: 20px;
            box-shadow: var(--shadow-sm); margin-bottom: 24px; height: 100%;
        }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .chart-title { font-size: 16px; font-weight: 700; color: var(--dark); }

        /* 4. 强大的表格与分页区 */
        .table-container { background: #fff; border-radius: var(--card-radius); box-shadow: var(--shadow-sm); padding: 5px; }
        
        /* 自定义 Tab 样式 */
        .nav-tabs-custom { border-bottom: 1px solid #f3f4f6; padding: 0 10px; }
        .nav-tabs-custom > li > a { 
            border: none; color: var(--gray); font-weight: 600; padding: 20px 20px; 
            font-size: 14px; transition: color 0.2s;
        }
        .nav-tabs-custom > li.active > a { 
            color: var(--primary); border-bottom: 2px solid var(--primary); background: transparent; 
        }
        .nav-tabs-custom > li > a:hover { color: var(--primary); background: transparent; }

        .table-wrapper { padding: 20px; }
        .table > thead > tr > th { 
            background: #f9fafb; border-bottom: none; color: var(--gray); font-weight: 600; 
            text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 12px 15px;
            &:first-child { border-top-left-radius: 8px; }
            &:last-child { border-top-right-radius: 8px; }
        }
        .table > tbody > tr > td { 
            padding: 16px 15px; border-top: 1px solid #f3f4f6; vertical-align: middle; color: #4b5563; font-size: 13px;
        }
        .table-hover > tbody > tr:hover { background-color: #f8fafc; }

        /* 状态徽章 */
        .badge-status { padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; }
        .badge-done { background: var(--success-soft); color: var(--success); }
        .badge-wait { background: var(--warning-soft); color: var(--warning); }
        .badge-ban { background: var(--danger-soft); color: var(--danger); }
        .badge-info { background: var(--primary-soft); color: var(--primary); }

        /* 分页控件 */
        .pagination-box { display: flex; justify-content: space-between; align-items: center; padding-top: 20px; border-top: 1px solid #f3f4f6; }
        .page-info { color: var(--gray); font-size: 13px; }
        .page-btns button {
            border: 1px solid #e5e7eb; background: #fff; padding: 6px 12px; border-radius: 6px; 
            color: #374151; margin-left: 5px; transition: all 0.2s; font-size: 12px;
        }
        .page-btns button:hover:not(:disabled) { border-color: var(--primary); color: var(--primary); }
        .page-btns button.active { background: var(--primary); color: #fff; border-color: var(--primary); }
        .page-btns button:disabled { opacity: 0.5; cursor: not-allowed; }

        /* 头像 */
        .avatar-sm { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; margin-right: 8px; vertical-align: middle; }
    </style>
</head>

<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeInRight">
        
        <div class="dashboard-header">
            <div class="header-title">
                <h2>综合运营指挥中心</h2>
                <small><i class="fa fa-map-marker"></i> 系统运行正常 | 数据同步于: <span id="updateTime">--:--</span></small>
            </div>
            <div>
                <button class="btn btn-white" onclick="location.reload()"><i class="fa fa-refresh"></i></button>
                <button class="btn btn-primary"><i class="fa fa-cloud-download"></i> 导出周报</button>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-3 col-md-6">
                <div class="metric-card card-blue">
                    <div class="metric-trend"><i class="fa fa-arrow-up"></i> 12%</div>
                    <div class="metric-icon"><i class="fa fa-users"></i></div>
                    <div class="metric-value">12,845</div>
                    <div class="metric-label">总用户数 (Total Users)</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="metric-card card-green">
                    <div class="metric-trend"><i class="fa fa-bolt"></i> +856</div>
                    <div class="metric-icon"><i class="fa fa-file-text-o"></i></div>
                    <div class="metric-value">2,304</div>
                    <div class="metric-label">今日内容发布 (Content)</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="metric-card card-orange">
                    <div class="metric-trend"><i class="fa fa-exclamation-triangle"></i> 需关注</div>
                    <div class="metric-icon"><i class="fa fa-flag"></i></div>
                    <div class="metric-value">242</div>
                    <div class="metric-label">待处理举报 (Pending)</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="metric-card card-red">
                    <div class="metric-trend"><i class="fa fa-plus"></i> 5人</div>
                    <div class="metric-icon"><i class="fa fa-ban"></i></div>
                    <div class="metric-value">212</div>
                    <div class="metric-label">累计封禁账号 (Banned)</div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-8">
                <div class="chart-box">
                    <div class="chart-header">
                        <span class="chart-title"><i class="fa fa-line-chart text-primary"></i> 流量与活跃度趋势</span>
                        <div class="btn-group">
                            <button class="btn btn-xs btn-white active">周</button>
                            <button class="btn btn-xs btn-white">月</button>
                        </div>
                    </div>
                    <div id="mainTrendChart" style="height: 320px;"></div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="chart-box">
                    <div class="chart-header">
                        <span class="chart-title"><i class="fa fa-shield text-danger"></i> 社区风险雷达</span>
                    </div>
                    <div id="riskChart" style="height: 320px;"></div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-4">
                <div class="chart-box" style="height: 300px;">
                    <div class="chart-header"><span class="chart-title">内容板块热度</span></div>
                    <div id="categoryChart" style="height: 220px;"></div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="chart-box" style="height: 300px;">
                    <div class="chart-header"><span class="chart-title">用户性别构成</span></div>
                    <div id="userPieChart" style="height: 220px;"></div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="chart-box" style="height: 300px;">
                    <div class="chart-header"><span class="chart-title">举报处理结果</span></div>
                    <div id="resultBarChart" style="height: 220px;"></div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="table-container">
                    
                    <ul class="nav nav-tabs nav-tabs-custom">
                        <li class="active"><a data-toggle="tab" href="#tab-report"><i class="fa fa-gavel"></i> 举报处理 (Reports)</a></li>
                        <li><a data-toggle="tab" href="#tab-user"><i class="fa fa-user-plus"></i> 最新用户 (New Users)</a></li>
                        <li><a data-toggle="tab" href="#tab-content"><i class="fa fa-list-alt"></i> 违规内容日志 (Logs)</a></li>
                    </ul>

                    <div class="tab-content table-wrapper">
                        
                        <div id="tab-report" class="tab-pane active">
                            <div class="row m-b-sm">
                                <div class="col-sm-3">
                                    <div class="input-group">
                                        <input type="text" placeholder="搜索举报ID/内容..." class="form-control input-sm">
                                        <span class="input-group-btn"><button class="btn btn-sm btn-primary">搜索</button></span>
                                    </div>
                                </div>
                            </div>
                            <table class="table table-hover">
                                <thead>
                                    <tr><th>ID</th><th>状态</th><th>类型</th><th>被举报内容</th><th>时间</th><th>结果</th><th>操作</th></tr>
                                </thead>
                                <tbody id="tableBody_report"></tbody>
                            </table>
                            <div class="pagination-box" id="pagination_report"></div>
                        </div>

                        <div id="tab-user" class="tab-pane">
                            <table class="table table-hover">
                                <thead>
                                    <tr><th>用户ID</th><th>头像/昵称</th><th>手机号</th><th>注册时间</th><th>状态</th><th>操作</th></tr>
                                </thead>
                                <tbody id="tableBody_user"></tbody>
                            </table>
                            <div class="pagination-box" id="pagination_user"></div>
                        </div>

                        <div id="tab-content" class="tab-pane">
                            <table class="table table-hover">
                                <thead>
                                    <tr><th>日志ID</th><th>操作人</th><th>操作类型</th><th>详情描述</th><th>时间</th></tr>
                                </thead>
                                <tbody id="tableBody_content"></tbody>
                            </table>
                            <div class="pagination-box" id="pagination_content"></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="js/jquery.min.js?v=2.1.4"></script>
    <script src="js/bootstrap.min.js?v=3.3.6"></script>
    <script src="js/echarts.min.js"></script>

    <script>
        $(document).ready(function() {
            // 时间更新
            var now = new Date();
            $('#updateTime').text(now.getHours() + ':' + (now.getMinutes()<10?'0':'') + now.getMinutes());

            // 初始化图表
            initCharts();
            
            // 初始化三个表格的分页数据
            initAllTables();

            $(window).resize(function() { resizeCharts(); });
        });

        // ================== 1. 通用分页逻辑系统 (核心功能) ==================
        
        // 模拟数据源
        const db = {
            reports: Array.from({length: 45}, (_, i) => ({
                id: 1000 + i,
                status: i % 3 === 0 ? 'wait' : 'done',
                type: ['广告推广', '人身攻击', '色情低俗', '政治敏感'][i % 4],
                content: `用户发布的第 ${i} 条内容涉嫌违规...`,
                time: '2025-12-' + (10 + i%20),
                result: i % 3 === 0 ? '等待审核' : (i % 5 === 0 ? '账号封禁' : '已删除'),
            })),
            users: Array.from({length: 30}, (_, i) => ({
                uid: 8000 + i,
                name: `User_${i}`,
                avatar: `https://ui-avatars.com/api/?name=User+${i}&background=random`,
                phone: `138${String(i).padStart(8, '0')}`,
                regTime: '2025-12-' + (1 + i%15),
                status: i % 10 === 0 ? 'banned' : 'active'
            })),
            logs: Array.from({length: 50}, (_, i) => ({
                logId: 5000 + i,
                admin: ['Admin', 'XiaoNing', 'System'][i % 3],
                action: ['删除帖子', '封禁用户', '审核通过', '修改配置'][i % 4],
                detail: `对 ID:${100+i} 进行了操作`,
                time: `12-${10+i%20} 10:${i%60}`
            }))
        };

        // 分页状态管理
        const pageState = {
            report: { current: 1, size: 5, data: db.reports },
            user: { current: 1, size: 5, data: db.users },
            content: { current: 1, size: 5, data: db.logs }
        };

        function initAllTables() {
            renderGenericTable('report');
            renderGenericTable('user');
            renderGenericTable('content');
        }

        // 通用渲染函数
        function renderGenericTable(type) {
            const state = pageState[type];
            const start = (state.current - 1) * state.size;
            const end = start + state.size;
            const pageData = state.data.slice(start, end);
            const $tbody = $(`#tableBody_${type}`);
            
            $tbody.empty();

            pageData.forEach(item => {
                let html = '';
                
                // 根据类型渲染不同的行结构
                if (type === 'report') {
                    const statusBadge = item.status === 'wait' 
                        ? '<span class="badge-status badge-wait">待处理</span>' 
                        : '<span class="badge-status badge-done">已处理</span>';
                    const resColor = item.result === '等待审核' ? 'text-warning' : (item.result.includes('封禁') ? 'text-danger' : 'text-success');
                    
                    html = `<tr>
                        <td><b>#${item.id}</b></td>
                        <td>${statusBadge}</td>
                        <td><span class="label label-default">${item.type}</span></td>
                        <td>${item.content}</td>
                        <td>${item.time}</td>
                        <td class="${resColor}">${item.result}</td>
                        <td>
                            <button class="btn btn-xs btn-white"><i class="fa fa-eye"></i></button>
                            ${item.status === 'wait' ? '<button class="btn btn-xs btn-primary">处理</button>' : ''}
                        </td>
                    </tr>`;
                } 
                else if (type === 'user') {
                    const statusBadge = item.status === 'active' 
                        ? '<span class="badge-status badge-done">正常</span>' 
                        : '<span class="badge-status badge-ban">封禁</span>';
                    
                    html = `<tr>
                        <td>${item.uid}</td>
                        <td><img src="${item.avatar}" class="avatar-sm"> <b>${item.name}</b></td>
                        <td>${item.phone}</td>
                        <td>${item.regTime}</td>
                        <td>${statusBadge}</td>
                        <td><button class="btn btn-xs btn-white">详情</button></td>
                    </tr>`;
                }
                else if (type === 'content') {
                    html = `<tr>
                        <td class="text-muted">${item.logId}</td>
                        <td><b>${item.admin}</b></td>
                        <td><span class="text-navy">${item.action}</span></td>
                        <td>${item.detail}</td>
                        <td><i class="fa fa-clock-o"></i> ${item.time}</td>
                    </tr>`;
                }

                $tbody.append(html);
            });

            renderGenericPagination(type);
        }

        // 通用分页控件渲染
        function renderGenericPagination(type) {
            const state = pageState[type];
            const totalPages = Math.ceil(state.data.length / state.size);
            const $container = $(`#pagination_${type}`);
            
            let btns = '';
            // 上一页
            btns += `<button onclick="changePage('${type}', ${state.current - 1})" ${state.current === 1 ? 'disabled' : ''}><</button>`;
            // 页码
            for (let i = 1; i <= totalPages; i++) {
                // 简单的页码显示逻辑，实际项目中可能需要折叠页码
                if (totalPages > 7 && Math.abs(state.current - i) > 2 && i !== 1 && i !== totalPages) continue; 
                btns += `<button class="${i === state.current ? 'active' : ''}" onclick="changePage('${type}', ${i})">${i}</button>`;
            }
            // 下一页
            btns += `<button onclick="changePage('${type}', ${state.current + 1})" ${state.current === totalPages ? 'disabled' : ''}>></button>`;

            const startIdx = (state.current - 1) * state.size + 1;
            const endIdx = Math.min(state.current * state.size, state.data.length);

            $container.html(`
                <div class="page-info">显示 ${startIdx} - ${endIdx} 条，共 ${state.data.length} 条</div>
                <div class="page-btns">${btns}</div>
            `);
        }

        // 切换页面函数 (暴露给全局)
        window.changePage = function(type, page) {
            const state = pageState[type];
            const totalPages = Math.ceil(state.data.length / state.size);
            if (page < 1 || page > totalPages) return;
            
            state.current = page;
            renderGenericTable(type);
        }

        // ================== 2. 图表融合逻辑 ==================
        
        var charts = {};

        function initCharts() {
            // Chart 1: 流量与互动趋势 (融合 stats_user 和 stats_content)
            charts.main = echarts.init(document.getElementById('mainTrendChart'));
            charts.main.setOption({
                tooltip: { trigger: 'axis' },
                legend: { data: ['活跃用户 (User)', '互动量 (Interaction)', '新增举报 (Report)'], bottom: 0 },
                grid: { top: '10%', left: '3%', right: '4%', bottom: '10%', containLabel: true },
                xAxis: { type: 'category', data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'], boundaryGap: false },
                yAxis: { type: 'value' },
                series: [
                    {
                        name: '活跃用户 (User)', type: 'line', smooth: true,
                        itemStyle: { color: '#4f46e5' },
                        areaStyle: { color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{offset: 0, color: '#4f46e544'}, {offset: 1, color: '#4f46e500'}]) },
                        data: [120, 132, 101, 134, 90, 230, 210]
                    },
                    {
                        name: '互动量 (Interaction)', type: 'line', smooth: true,
                        itemStyle: { color: '#10b981' },
                        data: [220, 182, 191, 234, 290, 330, 310]
                    },
                    {
                        name: '新增举报 (Report)', type: 'bar', barWidth: 10,
                        itemStyle: { color: '#ef4444' },
                        data: [12, 15, 8, 24, 10, 35, 20]
                    }
                ]
            });

            // Chart 2: 风险雷达 (来自 report_stats)
            charts.risk = echarts.init(document.getElementById('riskChart'));
            charts.risk.setOption({
                tooltip: {},
                radar: {
                    indicator: [
                        { name: '广告', max: 100 }, { name: '谩骂', max: 100 },
                        { name: '涉黄', max: 100 }, { name: '涉政', max: 100 },
                        { name: '灌水', max: 100 }
                    ],
                    radius: '65%', center: ['50%', '50%']
                },
                series: [{
                    type: 'radar',
                    data: [
                        { value: [80, 50, 20, 10, 60], name: '本周违规分布', itemStyle: { color: '#ef4444' }, areaStyle: { opacity: 0.2 } }
                    ]
                }]
            });

            // Chart 3: 内容板块饼图 (来自 content_stats)
            charts.cat = echarts.init(document.getElementById('categoryChart'));
            charts.cat.setOption({
                tooltip: { trigger: 'item' },
                color: ['#4f46e5', '#10b981', '#f59e0b', '#8b5cf6', '#6b7280'],
                series: [{
                    type: 'pie', radius: ['40%', '70%'],
                    itemStyle: { borderRadius: 5, borderColor: '#fff', borderWidth: 2 },
                    data: [
                        { value: 1048, name: '校园动态' }, { value: 735, name: '二手集市' },
                        { value: 580, name: '失物招领' }, { value: 484, name: '兼职' },
                        { value: 300, name: '其他' }
                    ]
                }]
            });

            // Chart 4: 用户性别 (来自 user_stats)
            charts.user = echarts.init(document.getElementById('userPieChart'));
            charts.user.setOption({
                tooltip: { trigger: 'item' },
                color: ['#3b82f6', '#ec4899', '#9ca3af'],
                series: [{
                    type: 'pie', radius: '70%',
                    data: [{ value: 735, name: '男' }, { value: 580, name: '女' }, { value: 100, name: '未知' }]
                }]
            });

            // Chart 5: 处理结果 (来自 report_stats)
            charts.res = echarts.init(document.getElementById('resultBarChart'));
            charts.res.setOption({
                tooltip: { trigger: 'axis' },
                grid: { top: '10%', bottom: '15%', left: '15%' },
                xAxis: { type: 'category', data: ['删帖', '封号', '驳回', '警告'] },
                yAxis: { type: 'value' },
                series: [{
                    type: 'bar', data: [120, 20, 50, 80],
                    itemStyle: { color: '#f59e0b', borderRadius: [4, 4, 0, 0] }
                }]
            });
        }

        function resizeCharts() {
            for (let key in charts) {
                charts[key].resize();
            }
        }
    </script>
</body>
</html>